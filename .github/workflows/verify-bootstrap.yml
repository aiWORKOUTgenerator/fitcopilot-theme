name: Verify Bootstrap Integrity

on:
  push:
    branches: [main, develop]
    paths:
      - 'src/**'
      - 'webpack.config.js'
      - 'package.json'
  pull_request:
    branches: [main, develop]
    paths:
      - 'src/**'
      - 'webpack.config.js'
      - 'package.json'

jobs:
  verify-bootstrap:
    name: Verify React Bootstrap Code
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Check React mount point
        run: npm run verify:mount
      
      - name: Build app
        run: npm run build
      
      - name: Verify bootstrap code in build
        run: npm run verify:bootstrap
      
      - name: Check webpack entry point
        run: |
          if ! grep -q "'./src/index.tsx'" webpack.config.js; then
            echo "❌ ERROR: webpack.config.js does not have src/index.tsx as entry point"
            exit 1
          fi
          echo "✅ Webpack entry point correctly set to src/index.tsx"
      
      # Uncomment when e2e tests are ready to run in CI
      # - name: Install Puppeteer dependencies
      #   run: |
      #     sudo apt-get update
      #     sudo apt-get install -y chromium-browser
      
      # - name: Start web server
      #   run: |
      #     npm run serve &
      #     sleep 10
      
      # - name: Run E2E mount check
      #   run: npm run verify:e2e-mount
      #   env:
      #     TEST_URL: http://localhost:3000
      
      - name: Upload build artifacts on failure
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: dist
          path: |
            dist/
            webpack.config.js
            src/index.tsx 