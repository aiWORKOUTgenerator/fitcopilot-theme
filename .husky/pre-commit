#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Check if this is a merge commit
if git rev-parse -q --verify MERGE_HEAD; then
  echo "‚è© Skipping pre-commit hook for merge commit"
  exit 0
fi

# Check for incremental build verification approach
if [ -f "dist/homepage.js" ]; then
  echo "üîç Checking existing dist/ files for bootstrap code..."
  if ! bash scripts/verify-bootstrap.sh; then
    echo "‚ùå Bootstrap verification failed!"
    echo "   This likely means your webpack entry point is incorrect."
    echo "   Please update webpack.config.js to use src/index.tsx as entry."
    exit 1
  fi
else
  echo "‚è© No dist files found, skipping bootstrap check (will be verified during build)"
fi

# Always run mount point verification
if ! npm run verify:mount; then
  echo "‚ùå Mount point verification failed!"
  echo "   Please fix the issues before committing."
  exit 1
fi

# Run standard lint checks
npm run lint ||
  (echo "‚ùå Linting failed! Please fix the issues before committing."; exit 1)

echo "‚úÖ Pre-commit checks passed!"
